<dom-module id="ti-mdbu-textbox">
	<link rel="import" type="css" href="ti-mdbu-textbox.css">
	<template>
		<div class="ctrl-hdr">
			{{label}}
		</div>
		<div class="ctrl-cnt">
			<input type="text" class="numbox" value="{{dispValue::input}}">
		</div>
	</template>
	<script>
		Polymer({
			is: 'ti-mdbu-textbox',
			properties: {
				label: {
					type: String,
					value: 'TextBox'
				},
				ishex: {
					type: Boolean,
					value: false
				},
				value: {
					type: String,
					value: '0'
				},
				cached: {
					type: String,
					value: '0'
				},
				min: {
					type: Number,
					value: 0
				},
				max: {
					type: Number,
					value: 15
				},
				dispValue: {
					type: String,
					value: '0x00',
					observer: '_calculateValue'
				}
			},
			convertHexToDecimal: function(hex) {
        return parseInt(hex, 16);
      },
			convertDecimalToHex: function(dec) {
        return '0x' + dec.toString(16);
      },
			changeValue: function(newDispValue, oldDispValue) {
				var value;
				if(this.ishex) {
					value = this.convertHexToDecimal(newDispValue);
					if (value == this.cached) {
						this.dispValue = this.convertDecimalToHex(parseInt(value));
						return;
					}
					if (!isNaN(value) && (value >= this.min) && (value <= this.max)) {
						this.cached = this.value = value + '';
						this.dispValue = this.convertDecimalToHex(parseInt(this.value));
					}
					else {
						this.dispValue = this.convertDecimalToHex(parseInt(this.cached));
					}
				} else {
					this.value = this.cached = newDispValue;
				}
			},
			_calculateValue: function(newDispValue, oldDispValue) {
				this.cancelDebouncer('change');
				this.debounce('change', function() {
					this.changeValue(newDispValue, oldDispValue);
				}, 750);
			},
			created: function(){
				console.log("Textbox is created");
			},
			ready: function() {
				if(this.ishex) {
					this.dispValue = this.convertDecimalToHex(parseInt(this.value));
				} else {
					this.dispValue = this.value;
				}
			}		
		})
	</script>
</dom-module>