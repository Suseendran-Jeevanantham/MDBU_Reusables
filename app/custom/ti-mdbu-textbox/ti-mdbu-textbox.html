<dom-module id="ti-mdbu-textbox">
	<link rel="import" type="css" href="ti-mdbu-textbox.css">
	<template>
		<div class="ctrl-hdr">
			{{objValue.label}}
		</div>
		<div class="ctrl-cnt">
			<input type="text" class="numbox" value="{{objValue.dispValue::input}}">
		</div>
	</template>
	<script>
		Polymer({
			is: 'ti-mdbu-textbox',
			properties: {
				objValue: {
					type: Object
				}
			},
			observers: [
				'_calculateValue(objValue.dispValue)'
			],
			convertHexToDecimal: function(hex) {
        return parseInt(hex, 16);
      },
			convertDecimalToHex: function(dec) {
        return '0x' + dec.toString(16);
      },
			changeValue: function(newDispValue) {
				if(!this.objValue) {
					return;
				}
				var value;
				if(this.objValue.ishex) {
					value = this.convertHexToDecimal(newDispValue);
					if (value == this.objValue.cached) {
						var value = this.convertDecimalToHex(parseInt(value));
						this.set('objValue.dispValue', value);
						return;
					}
					if (!isNaN(value) && (value >= this.objValue.min) && (value <= this.objValue.max)) {
						this.objValue.cached = this.objValue.value = value + '';
						var value = this.convertDecimalToHex(parseInt(this.objValue.value));
						this.set('objValue.dispValue', value);
					}
					else {
						var value = this.convertDecimalToHex(parseInt(this.objValue.cached));
						this.set('objValue.dispValue', value);
					}
				} else {
					this.objValue.value = this.objValue.cached = newDispValue;
				}
			},
			_calculateValue: function(newDispValue) {
				this.cancelDebouncer('change');
				this.debounce('change', function() {
					this.changeValue(newDispValue);
				}, 750);
			},
			created: function(){
				console.log("Textbox is created");
			},
			attached: function() {
				if(this.objValue.ishex) {
					var value = this.convertDecimalToHex(parseInt(this.objValue.value));
					this.set('objValue.dispValue', value);
				} else {
					this.set('objValue.dispValue', this.objValue.value);
				}
			}		
		})
	</script>
</dom-module>